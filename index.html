<!DOCTYPE html>
<html lang="es">
const apiKey = "AIzaSyCVHPIM7KbzWi3SKkb1lAo0ztGXarlLIeE";
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entrenador Personal IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoVBL5gI9kDXrdIGNORE_THIS_PART_for_security_reasonsYdIgnfY" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-qZvrmS2ekKPF2mSznTQsxqPgnpkI4DNTlrdIGNORE_THIS_PART_for_security_reasonsrjs" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            position: relative;
            min-height: 100vh;
            padding-bottom: 4rem; /* Espacio para el footer */
        }
        .main-gradient {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
        }
        /* --- MODIFICADO: Efecto Glassmorphism mejorado --- */
        .card {
            background-color: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn-primary {
            background-color: #fbbf24;
            color: #1e3a8a;
            transition: all 0.3s ease;
        }
        /* --- MODIFICADO: Sombra más pronunciada en hover --- */
        .btn-primary:hover {
            background-color: #f59e0b;
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.4);
        }
        .btn-secondary {
            background-color: transparent;
            color: #fbbf24;
            border: 1px solid #fbbf24;
            transition: all 0.3s ease;
        }
        .btn-secondary:hover {
            background-color: rgba(251, 191, 36, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.2);
        }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none;
            width: 20px; height: 20px;
            background: #fbbf24; cursor: pointer;
            border-radius: 50%; border: 2px solid #1e3a8a;
        }
        .slider-thumb::-moz-range-thumb {
            width: 20px; height: 20px;
            background: #fbbf24; cursor: pointer;
            border-radius: 50%; border: 2px solid #1e3a8a;
        }
        .calendar-day.selected {
            background-color: #fbbf24; color: #1e3a8a; font-weight: bold;
        }
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left-color: #fbbf24;
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* --- NUEVO: Animación de fade-in para las vistas --- */
        .view-animate {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="main-gradient text-white flex items-center justify-center p-4">

    <div class="w-full max-w-4xl mx-auto">
        <div id="language-selector-container" class="flex justify-end mb-4">
            <select id="language-selector" class="bg-blue-900/50 border border-blue-700 rounded-lg px-3 py-1 text-sm">
                <option value="es">Español</option><option value="en">English</option><option value="fr">Français</option>
            </select>
        </div>

        <div id="main-menu" class="text-center view-animate">
            <h1 id="app-title" class="text-4xl md:text-5xl font-bold mb-4">Entrenador Personal IA</h1>
            <p id="app-subtitle" class="text-lg text-blue-200 mb-8 max-w-2xl mx-auto">Tu compañero inteligente para alcanzar tus metas de triatlón y maratón.</p>
            <div class="grid md:grid-cols-2 gap-6">
                 <div id="plan-long-term-card" class="card rounded-2xl p-6 text-center cursor-pointer hover:border-amber-400 transition-all duration-300">
                    <div class="flex justify-center items-center mb-3">
                        <svg class="w-8 h-8 mr-3 text-amber-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <h2 id="plan-long-term-title" class="text-2xl font-semibold">Planificar un objetivo a largo plazo</h2>
                    </div>
                    <p id="plan-long-term-desc" class="text-blue-300">Define tu carrera y fecha objetivo. La IA creará tu plan de entrenamiento completo.</p>
                </div>
                <div id="plan-today-card" class="card rounded-2xl p-6 text-center cursor-pointer hover:border-amber-400 transition-all duration-300">
                     <div class="flex justify-center items-center mb-3">
                        <svg class="w-8 h-8 mr-3 text-amber-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        <h2 id="plan-today-title" class="text-2xl font-semibold">Planificar un entrenamiento para hoy</h2>
                    </div>
                    <p id="plan-today-desc" class="text-blue-300">Obtén una sesión personalizada basada en tu estado y disponibilidad actual.</p>
                </div>
            </div>
        </div>

        <div id="long-term-planner" class="hidden">
            <h2 id="long-term-planner-title" class="text-3xl font-bold text-center mb-6">Plan de Objetivo a Largo Plazo</h2>
            <div class="card rounded-2xl p-6">
                <div class="grid md:grid-cols-2 gap-x-6 gap-y-4">
                    <div class="space-y-4">
                        <div>
                            <label for="goal-type" id="goal-type-label" class="block mb-2 font-medium">1. Elige tu objetivo</label>
                            <select id="goal-type" class="w-full bg-blue-900/50 border border-blue-700 rounded-lg p-3">
                                <option value="race_10k" data-lang="race_10k">Carrera 10 Km</option>
                                <option value="half-marathon" data-lang="half_marathon">Media Maratón</option>
                                <option value="marathon" data-lang="marathon">Maratón</option>
                                <option value="tri-sprint" data-lang="tri_sprint">Triatlón Sprint</option>
                                <option value="tri-olympic" data-lang="tri_olympic">Triatlón Olímpico</option>
                                <option value="tri-md" data-lang="tri_md">Triatlón MD</option>
                                <option value="tri-ld" data-lang="tri_ld">Triatlón LD</option>
                            </select>
                        </div>
                        <div>
                            <label id="level-label" class="block font-medium mb-2">2. Elige tu nivel: <span id="level-value-text" class="font-bold text-amber-300">Medio</span></label>
                            <input id="level-slider" type="range" min="0" max="2" value="1" class="w-full h-2 bg-blue-800 rounded-lg appearance-none cursor-pointer slider-thumb">
                            <div class="flex justify-between text-xs text-blue-300 mt-1">
                                <span data-lang="beginner">Iniciación</span><span data-lang="intermediate">Medio</span><span data-lang="advanced">Alto</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label id="goal-date-label" class="block mb-2 font-medium">3. Selecciona la fecha de la carrera</label>
                        <div id="calendar" class="bg-blue-900/50 rounded-lg p-4">
                             </div>
                    </div>
                    <div id="time-goal-container" class="md:col-span-2 space-y-2 hidden">
                        <label id="time-goal-label" class="block font-medium">4. Introduce tu tiempo objetivo (opcional)</label>
                        <div class="grid grid-cols-3 gap-3">
                            <input type="number" id="goal-hours" placeholder="HH" min="0" class="w-full bg-blue-900/50 border border-blue-700 rounded-lg p-2 text-center" />
                            <input type="number" id="goal-minutes" placeholder="MM" min="0" max="59" class="w-full bg-blue-900/50 border border-blue-700 rounded-lg p-2 text-center" />
                            <input type="number" id="goal-seconds" placeholder="SS" min="0" max="59" class="w-full bg-blue-900/50 border border-blue-700 rounded-lg p-2 text-center" />
                        </div>
                    </div>
                </div>
                <button id="generate-long-term-plan-btn" class="btn-primary w-full mt-6 py-3 rounded-lg font-bold" data-lang="generate_plan">Generar Plan</button>
            </div>
        </div>

        <div id="today-planner" class="hidden">
             </div>

        <div id="plan-display" class="hidden">
            <div class="flex justify-between items-center mb-6 gap-4">
                <button id="back-btn" class="btn-primary px-4 py-2 rounded-lg font-bold">&lt; <span data-lang="back">Atrás</span></button>
                <h2 id="plan-title" class="text-3xl font-bold text-center flex-grow">Tu Plan de Entrenamiento</h2>
                <button id="download-pdf-btn" class="btn-secondary px-4 py-2 rounded-lg font-bold" data-lang="download_pdf">Descargar PDF</button>
            </div>
            <div id="plan-content" class="card rounded-2xl p-6 max-h-[60vh] overflow-y-auto">
                </div>
        </div>
        
        <div id="loading-overlay" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
            <div class="loader"></div>
        </div>

    </div>
    
    <footer class="absolute bottom-0 w-full text-center py-4 text-xs text-blue-300/60">
        &copy; 2025 FMDA
    </footer>

    <script>
        const { jsPDF } = window.jspdf;

        const translations = {
            es: {
                // ... todas las traducciones anteriores
                download_pdf: "Descargar PDF",
                time_goal_label: "4. Introduce tu tiempo objetivo (opcional)"
            },
            en: {
                // ...
                download_pdf: "Download PDF",
                time_goal_label: "4. Enter your goal time (optional)"
            },
            fr: {
                // ...
                download_pdf: "Télécharger PDF",
                time_goal_label: "4. Entrez votre temps cible (optionnel)"
            }
        };

        let currentLang = 'es';
        let currentDate = new Date();
        let selectedDate = null;
        
        const mainMenu = document.getElementById('main-menu');
        const longTermPlanner = document.getElementById('long-term-planner');
        const todayPlanner = document.getElementById('today-planner');
        const planDisplay = document.getElementById('plan-display');
        const loadingOverlay = document.getElementById('loading-overlay');
        const timeGoalContainer = document.getElementById('time-goal-container');

        function switchView(view) {
            const views = [mainMenu, longTermPlanner, todayPlanner, planDisplay];
            views.forEach(v => v.classList.add('hidden'));
            
            const targetView = document.getElementById(view);
            targetView.classList.remove('hidden');
            targetView.classList.add('view-animate');
        }

        function updateTexts() {
            // ... (función updateTexts completa, incluyendo la actualización de todos los elementos)
        }

        // --- Nuevas Funciones de Cálculo de Ritmo ---
        function calculatePaces(totalSeconds, distanceKm) {
            if (!totalSeconds || totalSeconds <= 0) return null;
            
            const racePaceSecKm = totalSeconds / distanceKm;
            return {
                racePace: formatPace(racePaceSecKm / 60),
                tempoPace: formatPace((racePaceSecKm + 15) / 60), // 15s/km más lento
                intervalPace: formatPace((racePaceSecKm - 10) / 60), // 10s/km más rápido
                easyPace: formatPace((racePaceSecKm + 75) / 60) // 1m15s/km más lento
            };
        }

        function formatPace(decimalMinutes) {
            const minutes = Math.floor(decimalMinutes);
            const seconds = Math.round((decimalMinutes - minutes) * 60);
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}/km`;
        }

        // --- Lógica de Generación de Planes MODIFICADA ---
        function getDetailedWorkout(dayIndex, weekPercent, goalType, level, langDict, paces) {
            // ... (lógica anterior)

            // Ejemplo de cómo usar los ritmos
            if (dayIndex === 2) { // Martes de series
                const reps = [4, 6, 8][level];
                const paceText = paces ? `a ${paces.intervalPace}` : "a ritmo 5k-10k";
                return `${wu(15)}. ${langDict.main_set}: ${reps} x 800m ${paceText} (rec: 400m trote). ${cd(10)}`;
            }
            if (dayIndex === 4 && !goalType.includes('tri')) { // Jueves de tempo
                const duration = [20, 30, 40][level];
                const paceText = paces ? `a ${paces.tempoPace}` : "a ritmo media maratón";
                return `${wu(15)}. ${langDict.main_set}: ${duration}min ${paceText}. ${cd(10)}`;
            }
             if (dayIndex === 0) { // Domingo - Tirada Larga
                // ...
                const paceText = paces ? `(aprox. ${paces.easyPace})` : "(ritmo suave Z2)";
                return `${langDict.long_run}: ${dist}km ${paceText}`;
            }
            // ... (resto de la lógica)
        }

        function generateLongTermPlan(goalType, level, targetDate, goalSeconds) {
            const langDict = translations[currentLang] || translations.es;
            // ...
            const distances = { 'marathon': 42.2, 'half-marathon': 21.1, 'race_10k': 10 };
            const paces = calculatePaces(goalSeconds, distances[goalType]);
            
            // ... (bucle for de semanas)
                // Dentro del bucle, al llamar a getDetailedWorkout:
                weeklyWorkouts[dayName] = getDetailedWorkout(day, weekPercent, goalType, level, langDict, paces);
            // ...
        }

        // --- Event Listeners ---

        document.getElementById('goal-type').addEventListener('change', (e) => {
            const runGoals = ['marathon', 'half-marathon', 'race_10k'];
            if (runGoals.includes(e.target.value)) {
                timeGoalContainer.classList.remove('hidden');
            } else {
                timeGoalContainer.classList.add('hidden');
            }
        });
        
        document.getElementById('generate-long-term-plan-btn').addEventListener('click', () => {
            // ... (código anterior para validaciones)
            
            let goalSeconds = 0;
            if (!timeGoalContainer.classList.contains('hidden')) {
                const hours = parseInt(document.getElementById('goal-hours').value) || 0;
                const minutes = parseInt(document.getElementById('goal-minutes').value) || 0;
                const seconds = parseInt(document.getElementById('goal-seconds').value) || 0;
                goalSeconds = (hours * 3600) + (minutes * 60) + seconds;
            }

            // ... (código para obtener goalType y level)

            // --- MODIFICADO: Pasar goalSeconds a la función
            const plan = generateLongTermPlan(goalType, level, selectedDate, goalSeconds);
            
            // ... (resto de la lógica)
        });

        // --- (Incluir aquí TODAS las demás funciones y listeners del script de la versión anterior) ---
        // generateTodayWorkout, displayWorkout, displayLongTermPlan, downloadPlanAsPDF, listeners de sliders, etc.
    </script>
</body>
</html>